# 红黑树

## 1.其他数据结构

### 1.1 数组

如何对数组进行查询？

- 遍历查找：时间复杂度为O(n)

- 二分查找：时间复杂度降为O(logN)，但必须确保数组是有序的

如何对数组进行添加？

- 找到添加的位置，对该位置之后的所有节点右移一位。如果已经没有空余空间，则需要扩容

### 1.2 链表

如何对链表进行查询？

- 遍历查询：时间复杂度为O(n)

如何对链表进行添加？

- 找到添加的节点位置，更改节点的next指针至新增节点，指定新增节点的next指针至原来的next节点

### 1.3 二叉搜索树

> 二叉搜索树的优点是左子树所有节点的val小于当前root的val，右子树所有节点的val大于当前root的val

结合了链表和有序数组二分查找的优点，搜索一个元素时的时间复杂度为O(logN)

二叉搜索树的缺点：

- 会退化成链表，这是搜索一个节点的时间复杂度就降为O(N)

### 1.4 AVL

> 二叉平衡树：在满足二叉搜索树的特性同时，左子树和右子树的高度差不超过1

每次插入新的节点时，通过**自平衡**操作确保满足平衡的特性。

缺点：每次插入一个元素时都要进行自平衡的操作

**红黑树解决了这个问题！！！**

## 2.特性

> 1. 每个节点要么是<strong>黑色</strong>，要么是**<font color=red>红色</font>**
> 2. 根节点是**黑色**
> 3. 每个叶子节点是**黑色**
> 4. 每个**<font color=red>红色节点</font>**的两个子节点一定都是黑色，不能两个红色节点相连
> 5. 任意一节点到每个叶子节点的路径都包含**相同数量**的**黑色节点**

红黑树并不是一个完美平衡的二叉搜索树

但是左子树和右子树的黑色节点的层数是相同的，也即任意一个节点到叶子节点的路径都包含相同数量的黑色节点(性质5)

所以我们叫红黑树这种平衡为<font color=orange>黑色完美平衡树</font>

<img src="E:\loubei\学习资料\Coding\笔记\集合\红黑树.assets\image-20220411141624517.png" alt="image-20220411141624517" style="zoom:80%;float:left" />

## 3.操作

### 3.1 自平衡操作

红黑树能够<font color=orange>自平衡</font>来保证对树进行CRUD时也能维持自己的5个特性

- 变色：节点的颜色由红变黑或由黑变红
- 左旋：以某个节点作为支点(旋转节点)，其右子节点变为旋转节点的父节点，右子节点的左子节点变为旋转节点的右子节点，左子节点保持不变
- 右旋：以某个节点作为支点(旋转节点)，其左子节点变为旋转节点的父节点，左子节点的右子节点变为旋转节点的左子节点，右子节点保持不变

<img src="E:\loubei\学习资料\Coding\笔记\集合\红黑树.assets\左旋-0eae1b6e.gif" alt="查看源图像" style="zoom:120%;float:left" />

<img src="E:\loubei\学习资料\Coding\笔记\集合\红黑树.assets\v2-665f59c694f38e71c8c7fddb7a4cb183_b.gif" alt="查看源图像" style="zoom:120%;float:left" />

### 3.2 插入

插入操作包含两部分工作：

- 查找插入位置
- 插入后自平衡

<font color=orange>注意：</font>插入节点，必须为<font color=red>红色</font>，插入的节点在父节点为黑色时不会破坏红黑树的5大特性，不需要做自平衡操作。

但如果插入的节点是黑色节点，那么插入位置所在的子树黑色节点总是多1，必须做自平衡操作。

![image-20220411145919806](E:\loubei\学习资料\Coding\笔记\集合\红黑树.assets\image-20220411145919806.png)

#### (1) 情景1：红黑树为空树

- 将插入节点作为根节点，然后将根节点设置为黑色

#### (2) 情景2：插入点的key已存在

- 替换原节点的value值

#### (3) 情景3：插入节点的父节点是黑节点

- 直接插入，不会影响自平衡

#### (4) 情景4：插入节点的父节点是红节点

根据性质2：父节点是红色一定不是根节点 根据性质4：爷爷节点一定是黑色节点

##### 情景4.1：叔叔节点存在，且为红色

<img src="E:\loubei\学习资料\Coding\笔记\集合\红黑树.assets\image-20220411142432723.png" alt="image-20220411142432723" style="zoom:150%;float:left" />

- 将父节点P和叔叔节点U改成黑色

- 将爷爷节点PP改为红色

- 以爷爷节点作为当前节点进行后续处理

##### 情景4.2：叔节点不存在或为黑节点，且插入节点的父节点是爷节点的左孩子

<img src="E:\loubei\学习资料\Coding\笔记\集合\红黑树.assets\image-20220411142946827.png" alt="image-20220411142946827" style="zoom:150%;float:left" />

###### 情景4.2.1：插入节点是父节点的左孩子（LL双红情况）

<img src="E:\loubei\学习资料\Coding\笔记\集合\红黑树.assets\image-20220411143152534.png" alt="image-20220411143152534" style="zoom:100%;float:left" />

- 将父亲节点改为黑色，将爷爷节点改为红色
- 对爷爷节点进行右旋

<img src="E:\loubei\学习资料\Coding\笔记\集合\红黑树.assets\image-20220411143324734.png" alt="image-20220411143324734" style="zoom:100%;float:left" />

###### 情景4.2.2：插入节点是父节点的右孩子（LR双红情况）

<img src="E:\loubei\学习资料\Coding\笔记\集合\红黑树.assets\image-20220411143922887.png" alt="image-20220411143922887" style="float:left" />

- 对父节点P进行左旋
- 将P设为当前节点，得到LL双红情况
- 将I设为黑色，将爷节点PP设为红色
- 对爷节点PP进行右旋

![image-20220411143904189](E:\loubei\学习资料\Coding\笔记\集合\红黑树.assets\image-20220411143904189.png)

##### 情景4.3：叔叔节点不存在或为黑节点，且插入节点的父节点是爷节点的右孩子

对应情景4.2，只是方向相反

<img src="E:\loubei\学习资料\Coding\笔记\集合\红黑树.assets\image-20220411144551923.png" alt="image-20220411144551923" style="zoom:100%;float:left" />

###### 情景4.3.1：插入节点是父节点的右孩子（RR双红情况）

<img src="E:\loubei\学习资料\Coding\笔记\集合\红黑树.assets\image-20220411144649800.png" alt="image-20220411144649800" style="zoom:120%;float:left" />

- 父节点P设为黑色，爷节点PP设为红色
- 对爷节点PP进行左旋

<img src="E:\loubei\学习资料\Coding\笔记\集合\红黑树.assets\image-20220411144736985.png" alt="image-20220411144736985" style="zoom:120%;float:left" />

###### 情景4.3.2：插入节点是父节点的左孩子（LR双红）

<img src="E:\loubei\学习资料\Coding\笔记\集合\红黑树.assets\image-20220411144834076.png" alt="image-20220411144834076" style="zoom:120%;float:left" />

- 对父节点p进行右旋
- 将P节点作为当前节点，得到RR双红情况
- 把I设为黑色，爷节点PP设为红色
- 对爷节点PP进行左旋

<img src="E:\loubei\学习资料\Coding\笔记\集合\红黑树.assets\image-20220411144902424.png" alt="image-20220411144902424" style="zoom:140%;float:left" />

#### 示例

![image-20220411145826208](E:\loubei\学习资料\Coding\笔记\集合\红黑树.assets\image-20220411145826208.png)

## 参考

[红黑树总结 - lukazan - 博客园 (cnblogs.com)](https://www.cnblogs.com/lukazan/p/14702151.html)

