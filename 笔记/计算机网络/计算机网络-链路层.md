# 链路层

## 给网络包再加三个控制

MAC模块会将包从缓冲区取出，并在开头加上报头和起始帧分界符（SFD)，在末尾加上用于检测错误的FCS（帧校验序列）

报头用来测定时机，SFD用来标记网络包的起始位置。末尾的FCS用来检查包传输过程中因噪声导致的数据错误，和磁盘等设备中使用的 CRC 错误校验码是同一种东西。

## 集线器和交换机

集线器属于物理层、交换机属于链路层。

交换机通过查找内部的MAC地址表，<font color=orange>利用交换电路将信号转发到特定的端口。</font>交换机支持全双工模式，可以同时进行发送和接收操作，集线器不具备这样的特征。

集线器通过广播的方式将消息传到所有端口。因此当集线器同时有两个端口进行数据输入时，会发生数据碰撞，无法同时传输多路信号。

## 路由器

路由器的工作原理与交换机类似，通过查表判断包转发的目标，不过<font color=orange>路由器是基于IP设计的，交换机是基于以太网设计的。</font>

路由器的收发端口通过以太网规则接收包的，即当端口的MAC地址和包的接收方MAC地址一致时，端口才接受这个包，否则丢弃这个包。然后路由器的转发模块会根据接收到的包的IP头部中记录的接收方IP地址，在路由表中进行查寻，以此判断转发目标。

交换机通过MAC头部中的接收方MAC地址来判断转发目标的，在表中只匹配完全一致的记录。

而路由器则是根据IP头部中的IP地址来判断的，会忽略主机号部分，只匹配网络号部分。

根据路由器的匹配规则，有时会匹配到多条候选记录，路由器首先会寻找网络号比特数最长的一条记录，网络号比特数越长，说明主机号比特数越短，意味着该子网可分配的主机数量越少，即子网中可能存在的主机数量越少，这一规则的目的是尽量缩小范围。如果最长网络数相同，会选择跃点数较小的记录。

当找不到匹配路由时选择**<font color=orange>默认路由</font>**，即子网掩码设置为0.0.0.0，那么任何地址都能匹配到这条记录，只要在这条记录中将网关设置为接入路由器的地址，当匹配不到其他路由时，网络包就会被转发到接入路由器。

<img src="https://i.loli.net/2021/12/03/JviFq1WXaN2Ahcb.png" alt="image-20211203091150268" style="zoom:110%;float:left" />